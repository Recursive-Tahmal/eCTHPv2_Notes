
### **Task 1: Has msbuild executed malware on the machine?**

1. **Purpose**: Detect malware executed via `msbuild.exe`.
2. **Process**:
    - Search for `msbuild` in Sysmon logs (Event ID 1):
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[4].Value -like "*msbuild*"} | fl
        ```
        
    - Check for the **Description** field:
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[6].Value -like "*msbuild*"} | fl
        ```
        
3. **Findings**:
    - MSBuild was renamed to `Windows_Reporting.exe` and executed with `Windows_Reporting.xml` as a command-line argument.

---

### **Task 2: What was the initial stager?**

1. **Purpose**: Identify the malware's initial execution method.
2. **Process**:
    - Search for `CMD` in Sysmon logs:
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[4].Value -like "*Cmd*"} | fl
        ```
        
3. **Findings**:
    - Parent process: `mshta.exe`, which executed `report.hta`.
    - File was executed in a browser, which started `Windows_Reporting.exe`.

---

### **Task 3: How was the malware downloaded?**

1. **Purpose**: Determine the download method used for the malware.
2. **Process**:
    - Search process creation events for `Windows_Reporting.exe`:
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[10].Value -like "*Windows_Reporting.exe*"} | fl
        ```
        
    - Look for XML file creation (Event ID 11):
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=11} | Where-Object {$_.Properties[5].Value -like "*Windows_Reporting.xml*"} | fl
        ```
        
    - Search for `certutil.exe` usage:
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[4].Value -like "*certutil.exe*"} | fl
        ```
        
3. **Findings**:
    - `certutil.exe` was used to download `Windows_Reporting.xml` from `http://52.77.211.51:8443`.

---

### **Task 4: What was the attacker's IP and Port?**

1. **Purpose**: Identify the C2 server IP and Port.
2. **Process**:
    - Check `Windows_Reporting.exe` connections in Sysmon (Event ID 3):
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=3} | Where-Object {$_.Properties[4].Value -like "*Windows_Reporting.exe*"} | fl
        ```
        
    - Count connections:
        
        ```powershell
        Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=3} | Where-Object {$_.Properties[4].Value -like "*Windows_Reporting.exe*"} | fl | measure
        ```
        
3. **Findings**:
    - C2 IP: `52.77.211.51`
    - Port: `8443`
    - 51 total connections observed.

---

### **Task 5: What known .NET offensive tools were executed?**

1. **Purpose**: Detect the use of offensive .NET tools.
2. **Process**:
    - Focus on detection of **GhostPack (SeatBelt)**.
    - Logs reveal its association with `Windows_Reporting.exe`.

---

### **Key Takeaways**

1. **Detection Methods**:
    - Use robust Sysmon rules and complementary data sources.
2. **Adversarial Tactics**:
    - Renaming legitimate tools (`msbuild`) to hide in plain sight.
    - Utilizing "Living off the Land" binaries like `certutil.exe`.
3. **Defensive Recommendations**:
    - Monitor for renamed binaries.
    - Enable detailed logging for process creation and file activity.

---

